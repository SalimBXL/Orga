<div class="row grille">

 <table class="table-condensed table table-bordered table-striped table-responsive">
        <thead>

        <% unless @vue_semaine %>
            <tr>
                <th>Mois</th>
                <% 31.times do |n_jour| %>
                    <th><%= n_jour+1 %></th>
                <% end %>
            </tr>
        <% else %>
            <tr>
                <th>Mois: <%= @date_depart.month %></th>
                <% 5.times do |n_jour| %>
                    <th><%= (@date_depart+n_jour).day %></th>
                <% end %>
            </tr>
        <% end %>

        </thead>

        <tbody>
            <% nombre = @vue_semaine ? 1 : 18 %>
            <% nombre.times do |n_mois| %>
                <% date_parcourue = (@date_depart + n_mois.months) %>

                <% annee = date_parcourue.year %>
                <% mois = date_parcourue.month %>
                <% numero_mois = "#{mois<10 ? '0' : ''}#{mois}" %>
                <% nombre_jours = @vue_semaine ? 5 : Time.days_in_month(mois, annee).to_i %>
                
                <!-- Chanhe la couleur de la ligne si mois parcouru est le mois actuel -->
                <% couleur_ligne_mois = ("#{Date.today.month}/#{Date.today.year}"=="#{date_parcourue.month}/#{date_parcourue.year}") ? "warning" : "default" %>

                <tr class=<%= "#{couleur_ligne_mois}" %>>
                    <td>
                        <%= "#{numero_mois}/#{annee}" %>
                    </td>
                    
                    <% nombre_jours.times do |n_jour| %>
                        <td align="center">
                            <!-- Récupère les enregistrements à la date parcourue -->
                            <% records = @vue_semaine ? @absences.where(date: "#{@date_depart+n_jour}") : @absences.where(date: "#{annee}-#{numero_mois}-#{n_jour+1}") %>


                            <!-- Si aucun enregistrement, on affiche une cellule vide -->
                            <% if records.empty? %>
                                <% 3.times do %><br><% end %>
                            <% else %>
                                <!-- sinon... -->
                                <% records.each do |record| %>
                                    <span class="label label-warning tab-cell"
                                        data-toggle="tooltip"
                                        title="
                                        <%= record.utilisateur.prenom_nom %> - <%= record.type_absence.nom %>
                                        ">
                                        <%= initiales(record.utilisateur) %>
                                    </span>
                                    <br>
                                <% end %>
                            <% end %>
                        </td>
                    <% end %>
                </tr>
            <% end %>
        </tbody>
    </table> 
</div>