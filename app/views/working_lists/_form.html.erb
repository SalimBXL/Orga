<%= form_with model: @working_list, local: true do |form| %>

    <% if @working_list.errors.any? %>
        <strong>WARNING</strong>
        <ul>
            <% @working_list.errors.full_messages.each do |message| %>
                <li><%= message %></li>
            <% end %>
        </ul>
    <% end %>

    <!-- SERVICE -->
    <SELECT NAME="Service" onChange='ChoixDuService(this.form)'>
    <OPTION>-- Choisissez un service ---</OPTION>
    <% @services.each do |service| %>
        <OPTION value='<%= service.id %>'><%= "[#{service.lieu.nom}]  -  #{service.nom}" %></OPTION>
    <% end %>
    </SELECT>

    <!-- JOUR -->
    <p>
        <div class='form-group'>
        <%= form.select(:jour_id, 
                @jours.collect {|w| ["<#{w.numero_semaine}> - [#{w.service.nom}] - #{nom_jour(w.numero_jour)} #{w.date} - #{w.utilisateur.prenom_nom} - #{am_pm(w.am_pm)}", w.id]}, 
                {
                    prompt: "-- Veuillez choisir un jour... ---",
                    onchange: "ChoixDesWorks()"
                }, 
                data: {
                    remote: true,
                    url: "#{new_working_list_path}",
                    method: 'get'
                }
            ) 
        %>
        </div>
    </p>
        

    <!-- WORK -->
    <SELECT NAME="Work">
    <OPTION>-- Choisissez une page ---</OPTION>
    <OPTION></OPTION>
    <OPTION></OPTION>
    <OPTION></OPTION>
    </SELECT>


    <%
=begin%>
 <p>
        <%= form.select(:work_id, 
                @works.collect {|w| ["<#{w.service.nom}> - #{w.groupe.nom} - #{w.classe.nom} - [ #{w.code} ] - #{w.nom}", w.id]}, 
                { }, 
                { :multiple => true, :size => 20 }
            ) 
        %>
    </p> 
<%
=end%>

    <p>
            <%= form.submit class: "btn btn-primary" %>
    </p>
<% end %>

<script>
    $('select').change(ChoixDuService);
    $('select').change(ChoixDesJours);

    function ChoixDuService() {
        let menuService = document.getElementsByName("Service")[0];
        let menuJour = document.getElementsByName("working_list[jour_id]")[0];
        let index = menuService.selectedIndex;
        if (index == 0) { return; }
        var txt = new Array (
            <% @jours.each do |w| %>
                '<%= "#{w.numero_semaine} - [#{w.service.nom}] - #{nom_jour(w.numero_jour)} #{w.date} - #{w.utilisateur.prenom_nom} - #{am_pm(w.am_pm)}" %>',
            <% end %>
            );
        switch (index) {
            case 1 : 
                var txt = new Array (
                    <% @jours.each do |w| %>
                        '<%= "#{w.numero_semaine} - [#{w.service.nom}] - #{nom_jour(w.numero_jour)} #{w.date} - #{w.utilisateur.prenom_nom} - #{am_pm(w.am_pm)}" %>',
                    <% end %>
                    ); 
                break;

            case 2 :             
                var txt = new Array ('Radioactivité','Information','Mesures'); break;

            case 3 : 
                var txt = new Array (
                    <% Work.all.each do |i| %>
                        '<%= "test #{i.code}" %>',
                    <% end %>
                    ); 
                break;

            default :
                var txt = new Array('');
                break;
        }
        for (i=0;i<txt.length;i++) {
            menuJour.options.length = txt.length+1;
            menuJour.options[i+1].text=txt[i];
        }
    } 


    function ChoixDesJours() {
        let menuJour = document.getElementsByName("working_list[jour_id]")[0];
        let menuWork = document.getElementsByName("Work")[0];
        let index = menuJour.selectedIndex;
        if (index == 0) { return; }
        switch (index) {
            case 1 : 
                var txt = new Array ('Matériel','Poissons','Sécurité'); break;

            case 2 :             
                var txt = new Array ('Radioactivité','Information','Mesures'); break;

            case 3 : 
                var txt = new Array (
                    <% Work.all.each do |i| %>
                        '<%= "test #{i.code}" %>',
                    <% end %>
                    ); 
                break;

            default :
                var txt = new Array('');
                break;
        }
        for (i=0;i<txt.length;i++) {
            menuWork.options.length = txt.length+1;
            menuWork.options[i+1].text=txt[i];
        }
    } 
</script>
